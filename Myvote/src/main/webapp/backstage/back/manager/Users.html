<table id="Users_data"></table>
 

<script>
obj=$('#Users_data').datagrid({  
	    url:'../../usersServlet',  
	    queryParams:{op:'findUsers'},
	    fitColumns:true,
	    striped:true,
	    loadMsg:"数据加载中",
	    pagination:true,
	    fit:true,
	    pageNumber:1,
	    pageSize:2,
	    pageList:[2,5,10,15,20,30,3],
	    sortName:'tids',
	    remoteSort:false,
	    columns:[[  
			{field:'tids',title:'',width:27,align:'center',checkbox:true}, 
			{field:'usid',title:'会员编号',width:96,align:'center',sortable:true}, 
	        {field:'uname',title:'会员姓名',width:96,align:'center',editor:{type:"text",options:{requires:true}}},  
	        {field:'upwd',title:'密码',width:96,align:'center',editor:{type:"text",options:{requires:true}}},  
	        {field:'email',title:'邮件帐号',width:96,align:'center',editor:{type:"email",options:{requires:true}}},  
	        {field:'email',title:'生日',width:96,align:'center',editor:{type:"text",options:{requires:true}}},
	        {field:'email',title:'性别',width:96,align:'center',editor:{type:"text",options:{requires:true}}},
	        {field:'email',title:'电话',width:96,align:'center',editor:{type:"text",options:{requires:true}}},
	        {field:'email',title:'情感状态',width:96,align:'center',editor:{type:"text",options:{requires:true}}},
	        {field:'email',title:'地址',width:96,align:'center',editor:{type:"text",options:{requires:true}}},
	        {field:'email',title:'邮编',width:96,align:'center',editor:{type:"text",options:{requires:true}}},
	        {field:'email',title:'激活状态',width:96,align:'center',editor:{type:"text",options:{requires:true}}},
	        {field:'photo',title:'头像',width:96,align:'center',
	        	formatter:function(value,rowData,index){
	        		if(value!=null){
	        			var str="";
	        			var pics=value.split(",");
	        			for(var i=0;i<pics.length;i++){
	        				str+="<img src='../../"+pics[i]+"'width='60px' height='60px'/>&nbsp;";
	        			}
	        			return str;
	        		}else{
	        			return;
	        		}
	        	}	
	        
	        }
	        
	     ]],
	    toolbar:[{
		    text:"删除",
		    iconCls:"icon-remove",
		    handler:function(){
		    	//获取选中的行
		   		var rows=obj.datagrid("getChecked");
		    	if(rows!=undefined){
		    		$.messager.confirm('信息确认','您确定要删除选定的数据吗?',function(rs){
		    			if(rs){
		    				var tids="";
		    				for(var i=0;i<rows.length-1;i++){
		    					tids+=rows[i].usid+",";
		    				}
		    				tids+=rows[i].usid;
		    				
		    				//发请求到数据库删除
		    				$.post("../../usersServlet",{op:"delUsers",usid:tids},function(data){
		    					if(data>0){
			    					$.messager.show({
			    						title:'成功提示',
			    						msg:'会员信息删除成功...',
			    						timeout:2000,
			    						showType:'slide'
			    					});
			    						
			    					rows=null;
			    					obj.datagrid("reload");//刷新表格
			    				}else{
			    					$.messager.alert('失败提示','会员信息删除失败...','error');
			    				}
		    				});
		    			}else{
		    				return;
		    			}
		    		});
		    	}else{
		    		$.messager.show({
						title:'温馨提示',
						msg:'请选中您要删除的数据...',
						timeout:2000,
						showType:'slide'
					});
		    	}
		    }
		 }]
	}); 

function addUsersInfo(){
	var uname=$.trim($("#Users_uname").val());
	var upwd=$.trim($("#Users_upwd").val());
	var email=$.trim($("#Users_email").val());

	$.ajaxFileUpload({
		url:"../../usersServlet?op=addUsers",
		secureuri:false,
		fileElementId:"Users_pics",
		dataType:"json",
		data:{uname:uname,upwd:upwd,email:email},
		success:function(data,status){
			if(data>0){
				$.messager.show({title:'成功提示',msg:"会员信息添加成功....",timeout:2000,showType:'slide'});
				$("#Users_uname").val("");
				$("#Users_upwd").val("");
				$("#Users_email").val("");
				$("#Users_pics_show").html("");
				$('#Users_data').datagrid("reload");
				$('#add_Users').dialog('close');
			}else{
				$.messager.alert("错误提示","会员信息添加失败...\n","error");
			}
		},
		error:function(data,status,e){
			$.messager.alert("错误提示","会员信息添加失败...\n"+e,"error");
		}
	});
}



</script>